<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link rel="stylesheet" href="/css/tailwind.min.min.457dc15ac9728ea8ce51b6ee57135c381611688c4abea2ae8ffded28e7a37daf.css">
  
  <link rel="stylesheet" href="/css/style.min.c0ad41ced7523ea8a0f933c901c8da089bf513df82f78df868dfee4406c85f57.css">
  <title>Document</title>
</head><body><header class="bg-white mb-3">
  <div class="container mx-auto px-10">
    <nav class="flex h-20 items-center justify-between">
      <a href=/ class="text-4xl">文章中心</a>

      <div>
        
        <a href="/categories/" class="ml-5">目录</a>
        
        <a href="/tags/" class="ml-5">标签</a>
        
      </div>
    </nav>
  </div>
</header><div class="container mx-auto p-10 bg-white ">
<div class="text-2xl text-gray-700 mb-4">Golang mongodb driver usage</div>
<div class="mb-3 text-xs">
  <span datetime=" 2021-04-04 23:56" class="text-gray-300">2021-04-04 23:56</span>
  <span class="mr-4 text-gray-300 italic"> <a href=/programe/golang/>programe/golang/</a></span>
</div>
<hr>
<h1 id="golang-and-mongodb">Golang and Mongodb</h1>
<ul>
<li>connect</li>
<li>crud</li>
</ul>
<h2 id="connect-database">Connect Database</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#ff79c6">package</span> database

<span style="color:#ff79c6">import</span> (
  <span style="color:#f1fa8c">&#34;context&#34;</span>
  <span style="color:#f1fa8c">&#34;fmt&#34;</span>
  <span style="color:#f1fa8c">&#34;log&#34;</span>
  <span style="color:#f1fa8c">&#34;time&#34;</span>

  <span style="color:#f1fa8c">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
  <span style="color:#f1fa8c">&#34;go.mongodb.org/mongo-driver/mongo/options&#34;</span>
)

<span style="color:#8be9fd;font-style:italic">var</span> (
  <span style="color:#6272a4">// DBClient is exposed db client
</span><span style="color:#6272a4"></span>  DBClient <span style="color:#ff79c6">*</span>mongo.Client
  <span style="color:#6272a4">// DB used in this app
</span><span style="color:#6272a4"></span>  DB <span style="color:#ff79c6">*</span>mongo.Database
)

<span style="color:#6272a4">// Connect a mongodb
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">Connect</span>(host, port <span style="color:#8be9fd">string</span>) <span style="color:#ff79c6">*</span>mongo.Client {
  clientOptions <span style="color:#ff79c6">:=</span> options.<span style="color:#50fa7b">Client</span>().<span style="color:#50fa7b">ApplyURI</span>(<span style="color:#f1fa8c">&#34;mongodb://&#34;</span> <span style="color:#ff79c6">+</span> host <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;:&#34;</span> <span style="color:#ff79c6">+</span> port)
  ctx, cancel <span style="color:#ff79c6">:=</span> context.<span style="color:#50fa7b">WithTimeout</span>(context.<span style="color:#50fa7b">Background</span>(), <span style="color:#bd93f9">30</span><span style="color:#ff79c6">*</span>time.Second)
  <span style="color:#ff79c6">defer</span> <span style="color:#50fa7b">cancel</span>()

  client, err <span style="color:#ff79c6">:=</span> mongo.<span style="color:#50fa7b">Connect</span>(ctx, clientOptions)

  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatal</span>(err)
  }

  err = client.<span style="color:#50fa7b">Ping</span>(context.<span style="color:#50fa7b">TODO</span>(), <span style="color:#ff79c6">nil</span>)

  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatal</span>(err)
  }
  fmt.<span style="color:#50fa7b">Println</span>(<span style="color:#f1fa8c">&#34;Connected to MongoDB!&#34;</span>)
  <span style="color:#ff79c6">return</span> client
}

<span style="color:#6272a4">// Disconnect mongodb
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">Disconnect</span>() {
  ctx, cancel <span style="color:#ff79c6">:=</span> context.<span style="color:#50fa7b">WithTimeout</span>(context.<span style="color:#50fa7b">Background</span>(), <span style="color:#bd93f9">30</span><span style="color:#ff79c6">*</span>time.Second)
  <span style="color:#ff79c6">defer</span> <span style="color:#50fa7b">cancel</span>()
  DBClient.<span style="color:#50fa7b">Disconnect</span>(ctx)
}

</code></pre></td></tr></table>
</div>
</div><h2 id="insert-document">Insert document</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#6272a4">// CreatePage add page to db
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">CreatePage</span>(c <span style="color:#ff79c6">*</span>fiber.Ctx) {
  loc <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">FixedZone</span>(<span style="color:#f1fa8c">&#34;UTC+8&#34;</span>, <span style="color:#ff79c6">+</span><span style="color:#bd93f9">8</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">60</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">60</span>)
  <span style="color:#8be9fd;font-style:italic">var</span> page Page
  page.Title = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;title&#34;</span>)
  page.Tag = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;tag&#34;</span>)
  page.Cate = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;cate&#34;</span>)
  page.Author = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;author&#34;</span>)
  page.Body = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;body&#34;</span>)
  page.ID = primitive.<span style="color:#50fa7b">NewObjectID</span>()
  page.CreatedAt = time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">In</span>(loc)
  page.UpdatedAt = time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">In</span>(loc)
  collection <span style="color:#ff79c6">:=</span> database.DB.<span style="color:#50fa7b">Collection</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)
  _, err <span style="color:#ff79c6">:=</span> collection.<span style="color:#50fa7b">InsertOne</span>(context.<span style="color:#50fa7b">TODO</span>(), page)
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatalln</span>(err.<span style="color:#50fa7b">Error</span>())
  }
  c.<span style="color:#50fa7b">Redirect</span>(<span style="color:#f1fa8c">&#34;/pages/show/&#34;</span> <span style="color:#ff79c6">+</span> page.ID.<span style="color:#50fa7b">Hex</span>())
}
</code></pre></td></tr></table>
</div>
</div><h2 id="read-one-document">Read One Document</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#6272a4">// ShowPage according id
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">ShowPage</span>(c <span style="color:#ff79c6">*</span>fiber.Ctx) {
  <span style="color:#6272a4">//  id := c.Params(&#34;id&#34;)
</span><span style="color:#6272a4"></span>  objID, _ <span style="color:#ff79c6">:=</span> primitive.<span style="color:#50fa7b">ObjectIDFromHex</span>(c.<span style="color:#50fa7b">Params</span>(<span style="color:#f1fa8c">&#34;id&#34;</span>))
  filter <span style="color:#ff79c6">:=</span> bson.M{<span style="color:#f1fa8c">&#34;_id&#34;</span>: objID}
  <span style="color:#8be9fd;font-style:italic">var</span> page Page
  collection <span style="color:#ff79c6">:=</span> database.DB.<span style="color:#50fa7b">Collection</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)

  err <span style="color:#ff79c6">:=</span> collection.<span style="color:#50fa7b">FindOne</span>(context.<span style="color:#50fa7b">TODO</span>(), filter).<span style="color:#50fa7b">Decode</span>(<span style="color:#ff79c6">&amp;</span>page)
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatal</span>(err)
  }

  e <span style="color:#ff79c6">:=</span> strconv.<span style="color:#50fa7b">FormatInt</span>(page.UpdatedAt.<span style="color:#50fa7b">Unix</span>(), <span style="color:#bd93f9">10</span>)

  <span style="color:#ff79c6">if</span> match <span style="color:#ff79c6">:=</span> c.<span style="color:#50fa7b">Get</span>(<span style="color:#f1fa8c">&#34;If-None-Match&#34;</span>); match <span style="color:#ff79c6">!=</span> <span style="color:#f1fa8c">&#34;&#34;</span> {
    <span style="color:#ff79c6">if</span> strings.<span style="color:#50fa7b">Contains</span>(match, e) {
      c.<span style="color:#50fa7b">Status</span>(<span style="color:#bd93f9">304</span>)
      <span style="color:#ff79c6">return</span>
    }
  }

  <span style="color:#6272a4">//page.Body = string(blackfriday.Run([]byte(page.Body)))
</span><span style="color:#6272a4"></span>
  c.Fasthttp.Response.Header.<span style="color:#50fa7b">Add</span>(<span style="color:#f1fa8c">&#34;Etag&#34;</span>, e)
  <span style="color:#50fa7b">Render</span>(c, <span style="color:#f1fa8c">&#34;PageShow&#34;</span>, page, page.Title)
}
</code></pre></td></tr></table>
</div>
</div><h2 id="get-more-document">Get More Document</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#6272a4">// GetPages retrieve all pages
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">GetPages</span>(c <span style="color:#ff79c6">*</span>fiber.Ctx) {
  collection <span style="color:#ff79c6">:=</span> database.DB.<span style="color:#50fa7b">Collection</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)

  findOptions <span style="color:#ff79c6">:=</span> options.<span style="color:#50fa7b">Find</span>()
  findOptions.<span style="color:#50fa7b">SetSort</span>(bson.M{<span style="color:#f1fa8c">&#34;created_at&#34;</span>: <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>}).<span style="color:#50fa7b">SetSkip</span>(offset).<span style="color:#50fa7b">SetLimit</span>(<span style="color:#bd93f9">10</span>)

  <span style="color:#8be9fd;font-style:italic">var</span> pages []Page

  <span style="color:#6272a4">// Passing bson.D{{}} as the filter matches all documents in the collection
</span><span style="color:#6272a4"></span>  cur, err <span style="color:#ff79c6">:=</span> collection.<span style="color:#50fa7b">Find</span>(context.<span style="color:#50fa7b">TODO</span>(), bson.D{{}}, findOptions)
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatal</span>(err)
  }

  <span style="color:#ff79c6">for</span> cur.<span style="color:#50fa7b">Next</span>(context.<span style="color:#50fa7b">TODO</span>()) {
    <span style="color:#8be9fd;font-style:italic">var</span> page Page
    err <span style="color:#ff79c6">:=</span> cur.<span style="color:#50fa7b">Decode</span>(<span style="color:#ff79c6">&amp;</span>page)
    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
      log.<span style="color:#50fa7b">Fatal</span>(err)
    }
    pages = <span style="color:#8be9fd;font-style:italic">append</span>(pages, page)
  }

  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">:=</span> cur.<span style="color:#50fa7b">Err</span>(); err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatal</span>(err)
  }
  <span style="color:#6272a4">// Close the cursor once finished
</span><span style="color:#6272a4"></span>  cur.<span style="color:#50fa7b">Close</span>(context.<span style="color:#50fa7b">TODO</span>())
  <span style="color:#50fa7b">RenderAdmin</span>(c, <span style="color:#f1fa8c">&#34;PageIndex&#34;</span>, fiber.Map{<span style="color:#f1fa8c">&#34;Data&#34;</span>: pages})
}

</code></pre></td></tr></table>
</div>
</div><h2 id="update-document">Update document</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#6272a4">// UpdatePage is
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">UpdatePage</span>(c <span style="color:#ff79c6">*</span>fiber.Ctx) {
  objID, err <span style="color:#ff79c6">:=</span> primitive.<span style="color:#50fa7b">ObjectIDFromHex</span>(c.<span style="color:#50fa7b">Params</span>(<span style="color:#f1fa8c">&#34;id&#34;</span>))
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    <span style="color:#ff79c6">return</span>
  }
  loc <span style="color:#ff79c6">:=</span> time.<span style="color:#50fa7b">FixedZone</span>(<span style="color:#f1fa8c">&#34;UTC+8&#34;</span>, <span style="color:#ff79c6">+</span><span style="color:#bd93f9">8</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">60</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">60</span>)
  <span style="color:#8be9fd;font-style:italic">var</span> page = fiber.Map{}
  page[<span style="color:#f1fa8c">&#34;title&#34;</span>] = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;title&#34;</span>)
  page[<span style="color:#f1fa8c">&#34;tag&#34;</span>] = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;tag&#34;</span>)
  page[<span style="color:#f1fa8c">&#34;cate&#34;</span>] = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;cate&#34;</span>)
  page[<span style="color:#f1fa8c">&#34;author&#34;</span>] = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;author&#34;</span>)
  page[<span style="color:#f1fa8c">&#34;body&#34;</span>] = c.<span style="color:#50fa7b">FormValue</span>(<span style="color:#f1fa8c">&#34;body&#34;</span>)
  page[<span style="color:#f1fa8c">&#34;updated_at&#34;</span>] = time.<span style="color:#50fa7b">Now</span>().<span style="color:#50fa7b">In</span>(loc)
  collection <span style="color:#ff79c6">:=</span> database.DB.<span style="color:#50fa7b">Collection</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)
  _, err = collection.<span style="color:#50fa7b">UpdateOne</span>(context.<span style="color:#50fa7b">TODO</span>(), bson.M{<span style="color:#f1fa8c">&#34;_id&#34;</span>: objID}, bson.M{<span style="color:#f1fa8c">&#34;$set&#34;</span>: page})

  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    log.<span style="color:#50fa7b">Fatalln</span>(err.<span style="color:#50fa7b">Error</span>())
  }
  c.<span style="color:#50fa7b">Redirect</span>(<span style="color:#f1fa8c">&#34;/admin/pages/1&#34;</span>)
}

</code></pre></td></tr></table>
</div>
</div><h2 id="operators">Operators</h2>
<p><a href="https://docs.mongodb.com/manual/reference/operator/">https://docs.mongodb.com/manual/reference/operator/</a></p>
<ul>
<li>Query and projection operators</li>
<li>Update operators</li>
<li>Query Modifiers</li>
</ul>
<h2 id="delete-document">Delete document</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">DeletePage</span>(c <span style="color:#ff79c6">*</span>fiber.Ctx) {
  objID, err <span style="color:#ff79c6">:=</span> primitive.<span style="color:#50fa7b">ObjectIDFromHex</span>(c.<span style="color:#50fa7b">Params</span>(<span style="color:#f1fa8c">&#34;id&#34;</span>))
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    <span style="color:#ff79c6">return</span>
  }

  collection <span style="color:#ff79c6">:=</span> database.DB.<span style="color:#50fa7b">Collection</span>(<span style="color:#f1fa8c">&#34;page&#34;</span>)

  _, err = collection.<span style="color:#50fa7b">DeleteOne</span>(context.<span style="color:#50fa7b">TODO</span>(), bson.M{<span style="color:#f1fa8c">&#34;_id&#34;</span>: objID})
  <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
    fmt.<span style="color:#50fa7b">Println</span>(err)
    <span style="color:#ff79c6">return</span>
  }
  c.<span style="color:#50fa7b">Redirect</span>(<span style="color:#f1fa8c">&#34;/admin/pages/1&#34;</span>)
}

</code></pre></td></tr></table>
</div>
</div>

    </div></body>

</html>